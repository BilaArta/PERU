<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">

    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>

    <!-- Popper JS -->
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script> -->

    <!-- Latest compiled JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

    <script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
    <!-- <script src="https://code.jquery.com/jquery-3.3.1.js"></script> -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css">
    <script src="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.js"></script>
    <style>
        body {
            background-color: #f1f2f6
        }

        ,
        #checkboxs label input {
            margin: 28px
        } 
    </style>

</head>

<body>
    <div class="container">
        <ul class="nav nav-black nav-tabs">
            <li class="nav-item">
                <a class="nav-link active" data-toggle="tab" href="#home">PTL</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-toggle="tab" href="#menu1">Admin Aktivasi</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-toggle="tab" href="#menu2">Admin Aset</a>
            </li>
            <li class="nav-item">
                <label class="nav-link" id="userName"></label>
            </li>
            <li class="nav-item">
                <button class="nav-link" id="btnLogout">Logout</button>
            </li>
        </ul>

        <div class="tab-content">
            <div class="tab-pane active" id="home">
                <div class="row">
                    <div class="col-md-12">
                        <h1 class="text-center"><b>DATA SO</b></h1>
                    </div>
                </div>

                <hr>

                <table id="example" class="display" style="width:100%">
                    <button class="btn btn-success" data-toggle="modal" data-target="#dataSo"
                        style="margin-bottom: 12px">TAMBAH DATA</button>

                    <!-- The Modal -->
                    <div class="modal fade bd-example-modal-lg" id="dataSo">
                        <div class="modal-dialog modal-lg">
                            <div class="modal-content">

                                <!-- Modal Header -->
                                <div class="modal-header">
                                    <h4 class="modal-title">TAMBAH DATA SO</h4>
                                    <button type="button" class="close" data-dismiss="modal">×</button>
                                </div>

                                <!-- Modal body -->
                                <div class="modal-body">

                                    <form class="was-validated" method="POST">
                                        <div class="form-group">
                                            <label for="noSo">No SO :</label>
                                            <input type="text" class="form-control" id="noSo" placeholder="" name="noSo"
                                                required>
                                            <div class="valid-feedback">Valid.</div>
                                            <div class="invalid-feedback">Please fill out this field.</div>
                                        </div>
                                        <div class="form-group">
                                            <label>Nama SO :</label>
                                            <input type="text" class="form-control" id="namaSo" placeholder=""
                                                name="namaSo" required>
                                            <div class="valid-feedback">Valid.</div>
                                            <div class="invalid-feedback">Please fill out this field.</div>
                                        </div>
                                        <div class="form-group">
                                            <label for="noPs">No PS :</label>
                                            <input type="text" class="form-control" id="noPs" placeholder="" name="noPs"
                                                required>
                                            <div class="valid-feedback">Valid.</div>
                                            <div class="invalid-feedback">Please fill out this field.</div>
                                        </div>
                                        <div class="form-group">
                                            <label for="noIo">No IO :</label>
                                            <input type="text" class="form-control" id="noIo" placeholder="" name="noIo"
                                                required>
                                            <div class="valid-feedback">Valid.</div>
                                            <div class="invalid-feedback">Please fill out this field.</div>
                                        </div>
                                        <div class="form-group">
                                            <label for="alamat">Alamat :</label>
                                            <input type="text" class="form-control" id="alamat" placeholder=""
                                                name="alamat" required>
                                            <div class="valid-feedback">Valid.</div>
                                            <div class="invalid-feedback">Please fill out this field.</div>
                                        </div>
                                </div>
                                <!-- Modal footer -->
                                <div class="modal-footer">
                                    <button type="button" id="btnSo" class="btn btn-primary">Submit</button>
                                    </form>
                                </div>

                            </div>
                        </div>
                    </div>

                    <thead>
                        <tr>
                            <th>No SO</th>
                            <th>Nama SO</th>
                            <th>No PS</th>
                            <th>No IO</th>
                            <th>Alamat</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="listDataSo">

                    </tbody>
                    <tfoot>
                        <tr>
                            <th>No SO</th>
                            <th>Nama SO</th>
                            <th>No PS</th>
                            <th>No IO</th>
                            <th>Alamat</th>
                            <th>Action</th>
                        </tr>
                    </tfoot>
                    {{!-- <button class="btn btn-success" data-toggle="modal" data-target="#dataSo"
                        style="margin-bottom: 12px">TAMBAH DATA</button> --}}

                    <!-- The Modal ===================================== MODAL EDIT SO-->
                    <div class="modal fade bd-example-modal-lg" id="editDataSo">
                        <div class="modal-dialog modal-lg">
                            <div class="modal-content">

                                <!-- Modal Header -->
                                <div class="modal-header">
                                    <h4 class="modal-title">EDIT DATA SO <br> <label id="label"></label></h4>
                                    <input type="text" id="doc" style="display:none">
                                    <button type="button" class="close" data-dismiss="modal">×</button>
                                </div>

                                <!-- Modal body -->
                                <div class="modal-body">
                                    <form class="was-validated" method="POST">
                                        <div class="form-group">
                                            <label for="noSo">No SO :</label>
                                            <input type="text" class="form-control" id="editNoSo" placeholder=""
                                                name="noSo" required>
                                            <div class="valid-feedback">Valid.</div>
                                            <div class="invalid-feedback">Please fill out this field.</div>
                                        </div>
                                        <div class="form-group">
                                            <label>Nama SO :</label>
                                            <input type="text" class="form-control" id="editNamaSo" placeholder=""
                                                name="namaSo" required>
                                            <div class="valid-feedback">Valid.</div>
                                            <div class="invalid-feedback">Please fill out this field.</div>
                                        </div>
                                        <div class="form-group">
                                            <label for="noPs">No PS :</label>
                                            <input type="text" class="form-control" id="editNoPs" placeholder=""
                                                name="noPs" required>
                                            <div class="valid-feedback">Valid.</div>
                                            <div class="invalid-feedback">Please fill out this field.</div>
                                        </div>
                                        <div class="form-group">
                                            <label for="noIo">No IO :</label>
                                            <input type="text" class="form-control" id="editNoIo" placeholder=""
                                                name="noIo" required>
                                            <div class="valid-feedback">Valid.</div>
                                            <div class="invalid-feedback">Please fill out this field.</div>
                                        </div>
                                        <div class="form-group">
                                            <label for="alamat">Alamat :</label>
                                            <input type="text" class="form-control" id="editAlamat" placeholder=""
                                                name="alamat" required>
                                            <div class="valid-feedback">Valid.</div>
                                            <div class="invalid-feedback">Please fill out this field.</div>
                                        </div>
                                </div>
                                <!-- Modal footer -->
                                <div class="modal-footer">
                                    <button type="button" id="editBtnSo" class="btn btn-primary">Submit</button>
                                    </form>
                                </div>

                            </div>
                        </div>
                    </div> {{!-- =============== End Modal EDIT DATA SO =============== --}}
                </table>


                <!-- The Modal ===================================== MODAL DISPO DATA SO-->
                <div class="modal fade bd-example-modal-lg" id="dispoDataSo">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">

                            <!-- Modal Header -->
                            <div class="modal-header">
                                <h4 class="modal-title">DISPO DATA SO TO :<br> <label id="labelDispo"></label></h4>
                                <input type="text" id="docDispoSo" style="display:none">
                                <button type="button" class="close" data-dismiss="modal">×</button>
                            </div>

                            <!-- Modal body -->
                            <div class="modal-body">
                                 <div> {{!-- //class="was-validated" --}}
                                    <div class="form-group">
                                        <label for="noSo">Add Email :</label>
                                        <div class="form-inine" >
                                        <input type="email" class="form-control"  id="inputEmail"
                                            placeholder="example@email.com"
                                            name="inputEmail" required>
                                            <button  type="button" id="btnAddEmail">Add Email</button>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label><b>Send Email to :</b></label>
                                        <div>
                                            <div id="checkboxs">

                                            </div>
                                            <hr>
                                            <label><b>CC to :</b></label>
                                            <div id="checkboxsCC">

                                            </div>
                                        </div>
                                        <hr>
                                        <div>
                                            <label for="subject"><b>Subject Email :</b></label>
                                            <input type="text" class="form-control" id="textSubject" name="textSubject">
                                        </div>
                                    </div>   
                            </div>
                            <!-- Modal footer -->
                            <div class="modal-footer">
                                <button type="button" id="dispoBtnSo" class="btn btn-primary">Submit</button>
                                </div>
                            </div>

                        </div>
                    </div>
                </div> {{!-- =============== End Modal DISPO DATA SO =============== --}}

            </div>

            {{!-- ================================================================ PAGE DATA SO ========================================================================= --}}

            <div class="tab-pane fade" id="menu1">
                <div class="row">
                    <div class="col-md-12">
                        <h1 class="text-center"><b>DATA ASET</b></h1>
                    </div>
                </div>
                <hr>
                <table id="tableAset" class="display" style="width:100%">
                    <button class="btn btn-success" data-toggle="modal" data-target="#dataAset"
                        style="margin-bottom: 12px">TAMBAH DATA</button>

                    <!-- The Modal -->
                    <div class="modal fade bd-example-modal-lg" id="dataAset">
                        <div class="modal-dialog modal-lg">
                            <div class="modal-content">

                                <!-- Modal Header -->
                                <div class="modal-header">
                                    <h4 class="modal-title">TAMBAH DATA ASET</h4>
                                    <button type="button" class="close" data-dismiss="modal">×</button>
                                </div>
                                <!-- Modal body -->
                                <div class="modal-body">

                                    <form action="/action_page.php" class="was-validated" method="POST">
                                        <div class="form-group">
                                            <label for="uname">Nama POP :</label>
                                            <input type="text" class="form-control" id="uname" placeholder=""
                                                name="uname" required>
                                            <div class="valid-feedback">Valid.</div>
                                            <div class="invalid-feedback">Please fill out this field.</div>
                                        </div>
                                        <div class="form-group">
                                            <label for="pwd">Keterangan :</label>
                                            <input type="text" class="form-control" id="pwd" placeholder="" name="pswd"
                                                required>
                                            <div class="valid-feedback">Valid.</div>
                                            <div class="invalid-feedback">Please fill out this field.</div>
                                        </div>
                                </div>
                                <!-- Modal footer -->
                                <div class="modal-footer">
                                    <button type="submit" class="btn btn-primary">Submit</button>
                                    </form>
                                </div>

                            </div>
                        </div>
                    </div>

                    <thead>
                        <tr>
                            <th>Id</th>
                            <th>Name</th>
                            <th>Position</th>
                            <th>Office</th>
                            <th>Age</th>
                            <th>Start date</th>
                            <th>Salary</th>
                        </tr>
                    </thead>
                    <tbody>

                    </tbody>
                    <tfoot>
                        <tr>
                            <th>Name</th>
                            <th>Position</th>
                            <th>Office</th>
                            <th>Age</th>
                            <th>Start date</th>
                            <th>Salary</th>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>


        <script src="https://www.gstatic.com/firebasejs/6.2.4/firebase-app.js"></script>


        <!-- Add Firebase products that you want to use -->
        <script src="https://www.gstatic.com/firebasejs/6.2.4/firebase-auth.js"></script>
        <script src="https://www.gstatic.com/firebasejs/6.2.4/firebase-firestore.js"></script>

        <script>
            var firebaseConfig = {
                apiKey: "{{dataFb.apiKey}}",
                authDomain: "{{dataFb.authDomain}}",
                databaseURL: "{{dataFb.databaseURL}}",
                projectId: "{{dataFb.projectId}}",
                storageBucket: "{{dataFb.storageBucket}}",
                messagingSenderId: "{{dataFb.messagingSenderId}}",
                appId: "{{dataFb.appId}}"
            };
            // Initialize Firebase
            firebase.initializeApp(firebaseConfig);
            const db = firebase.firestore()


            function addEmail(){
                
            }

            function textContentSo(doc) {
                var tr = document.createElement('tr');
                var namaSo = document.createElement('td');
                var noSo = document.createElement('td');
                var noPs = document.createElement('td');
                var noIo = document.createElement('td');
                var alamat = document.createElement('td');


                var span = document.createElement('td');
                var edit = document.createElement('button');
                var view = document.createElement('button');
                var dispo = document.createElement('button');

                $(edit).attr({
                    "data-toggle": "modal",
                    "data-target": "#editDataSo"
                })
                $(view).attr({
                    "data-toggle": "modal",
                    "data-target": "#editDataSo"
                })
                $(dispo).attr({
                    "data-toggle": "modal",
                    "data-target": "#dispoDataSo"
                })


                edit.addEventListener("click", (e) => {
                    var val = $(e.target.parentNode.parentNode).data('id')

                    db.collection("Data SO").doc(val).get()
                        .then((doc) => {
                            if (doc.exists) {
                                $('#doc').val(val)
                                $('#label').text(doc.data().noSo)
                                $('#editNoSo').val(doc.data().noSo)
                                $('#editNamaSo').val(doc.data().namaSo)
                                $('#editNoPs').val(doc.data().noPs)
                                $('#editNoIo').val(doc.data().noIo)
                                $('#editAlamat').val(doc.data().alamat)
                            } else {
                                console.log("No such document")
                            }
                        }).catch((error) => {
                            console.log(error)
                        })
                })
                //tr.addEventListener("click", getElm)
                edit.textContent = "Edit";
                view.textContent = "View";
                dispo.textContent = "dispo";
                span.appendChild(edit)
                span.appendChild(view)
                span.appendChild(dispo)

                //console.log(doc)
                noSo.textContent = doc.data().noSo;
                namaSo.textContent = doc.data().namaSo;
                noPs.textContent = doc.data().noPs;
                noIo.textContent = doc.data().noIo;
                alamat.textContent = doc.data().alamat;
                //console.log(doc.id)
                tr.setAttribute('data-id', doc.id)
                tr.appendChild(noSo);
                tr.appendChild(namaSo);
                tr.appendChild(noPs);
                tr.appendChild(noIo);
                tr.appendChild(alamat);
                tr.appendChild(span);
                listDataSo.appendChild(tr);
            }

            function getDataSo() {
                var n = 0
                db.collection('Data SO').get().then((docs) => {
                    docs.forEach((doc) => {
                        textContentSo(doc)
                        n++
                    })
                    $('#example').DataTable({});
                    console.log(n)
                })
            }

            function createElmCheckBox(doc, n, id) {
                var input = document.createElement('input')
                var label = document.createElement('label')
                var span = document.createElement('span')
                
                $(span).css({
                    'margin': 12,
                    'font-size': 16
                })
                $(input).css('margin', 8)
                $(label).css('width', 320)

                $(input).attr('type', 'checkbox')
                $(input).attr('name', 'list')
                $(input).val(doc.data().email)
                label.textContent = doc.data().email

                $(span).append(label)
                $(span).append(input)
                var span2 = span
                $(id).append(span)

                if (n % 2 == 0) {
                    var br = document.createElement('br')
                    $(id).append(br)
                }  
            }

            function addDataEmail() {
                $("#btnAddEmail").on("click", (e) => {
                    var email = $('#inputEmail').val()
                    db.collection("email").doc().set({email : email.trim()})
                    .then(console.log("email added"))
                })
            }

            function getDataEmail() {
                var n = 1
                db.collection("email").onSnapshot(function(snapshot) {
                snapshot.docChanges().forEach(function(change) {
                    if (change.type === "added") {
                        createElmCheckBox(change.doc, n, "#checkboxs")
                        createElmCheckBox(change.doc, n, "#checkboxsCC")
                    }
                    if (change.type === "modified") {
                        console.log("Modified city: ", change.doc.data());
                    }
                    if (change.type === "removed") {
                        console.log("Removed city: ", change.doc.data());
                    }
                    n++
                });
                })
            }

            function editDataSo() {
                var noSo = document.getElementById('editNoSo').value;
                var namaSo = $('#editNamaSo').val();
                var noPs = $('#editNoPs').val();
                var noIo = $('#editNoIo').val()
                var alamat = $('#editAlamat').val()
                var id = $('#doc').val()
                noSo = noSo.trim();

                db.collection("Data SO").doc(id)
                    .update({
                        noSo: noSo,
                        namaSo: namaSo,
                        noIo: noIo,
                        noPs: noPs,
                        alamat: alamat
                    }).then(() => {
                        alert("Document successfully Edited!");
                        window.location.replace(window.location.href)
                    })
                    .catch(function (error) {
                        alert("Error writing document: ", error);
                    });
            }

            function addDataSo() {
                var noSo = document.getElementById('noSo').value;
                var namaSo = $('#namaSo').val();
                var noPs = $('#noPs').val();
                var noIo = $('#noIo').val()
                var alamat = $('#alamat').val()
                noSo = noSo.trim();

                var i = 0
                var id = []
                var validate = db.collection('Data SO').where('noSo', '==', noSo).get()
                    .then((snapshot) => {
                        snapshot.forEach((doc) => {
                            console.log(doc.id)
                            if (doc.id != null) {
                                id[i] = doc.id;
                                i++;
                            }
                        })
                        //console.log(i);
                        //console.log(id);
                        if (i == 0) {
                            var data = db.collection("Data SO").doc()
                            data.set({
                                    noSo: noSo,
                                    namaSo: namaSo,
                                    noIo: noIo,
                                    noPs: noPs,
                                    alamat: alamat
                                })
                                .then(function () {
                                    alert("Document successfully written!");
                                    window.location.replace(window.location.href)
                                })
                                .catch(function (error) {
                                    alert("Error writing document: ", error);
                                });
                        } else {
                            alert("Data already exsist!")
                        }
                    })
            }
            $(document).ready((e) => {
                
                //get data table
                firebase.auth().onAuthStateChanged(function (user) {
                    if (user) {
                        // User is signed in.
                        var displayName = user.displayName;
                        var email = user.email;
                        var emailVerified = user.emailVerified;
                        var photoURL = user.photoURL;
                        var isAnonymous = user.isAnonymous;
                        var uid = user.uid;
                        var providerData = user.providerData;
                        $('#userName').text(displayName);
                        name = displayName;

                        console.log(name + " Online")

                    } else {
                        console.log(' Account Logout')
                    }
                });

                $('#dispoBtnSo').on('click', () => {
                    //var arr = []
                    //$("input[name='list']:checked").each(function() {
                        //arr.push(this.value)
                    //});
                    //console.log(arr)
                    
                    var n = document.createElement("input");
                    $(n).val("Bilbil")
                    $(n).attr('name', 'n')
                    console.log(n)
                    window.location.replace(window.location.href +'/email');
                })

                getDataSo()
                getDataEmail()
                addDataEmail()

                $('#btnSo').on('click', () => {
                    addDataSo();
                })
                $('#editBtnSo').on('click', () => {
                    if (confirm("Are u Sure Update Data?")) {
                        editDataSo()
                    } else {
                        alert("cancel edit data")
                    }
                })

                $('.dispo').on('click', () => {
                    console.log(this)
                    alert('click')
                })
            })
        </script>

</body>

</html>